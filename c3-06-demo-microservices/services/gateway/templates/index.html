<!DOCTYPE html>
<html>
<head>
    <title>Microservices Demo</title>
    <style>
        body { font-family: Arial; max-width: 1000px; margin: 50px auto; padding: 20px; }
        .section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        h2 { color: #333; }
        input, select { padding: 8px; margin: 5px; width: 200px; }
        button { padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #5568d3; }
        .item { padding: 10px; margin: 5px 0; background: white; border-radius: 4px; }
        .info-box { background: #e7f3ff; border-left: 4px solid #2196F3; padding: 15px; margin: 20px 0; }
        .service-status { display: inline-block; padding: 5px 10px; margin: 5px; border-radius: 4px; font-size: 12px; }
        .healthy { background: #4caf50; color: white; }
        .unhealthy { background: #ff9800; color: white; }
        .down { background: #f44336; color: white; }
    </style>
</head>
<body>
    <h1>Microservices Architecture Demo</h1>
    <p><strong>Case Study:</strong> E-commerce with independent services</p>

    <div class="info-box">
        <h3>Microservice Characteristics:</h3>
        <ul>
            <li>Each service runs independently</li>
            <li>Each service has its own database</li>
            <li>Services communicate via HTTP REST API</li>
            <li>Can deploy and scale each servcie independently</li>
            <li>Fault isolation: if one service fails, others continue</li>
        </ul>
        <div id="serviceStatus"></div>
    </div>

    <div class="section">
        <h2>1. User Service (Port 5001)</h2>
        <form onsubmit="createUser(event)">
            <input type="email" name="email" placeholder="Email" required>
            <input type="text" name="name" placeholder="Name" required>
            <button type="submit">Create User</button>
        </form>
        <div id="users"></div>
    </div>

    <div class="section">
        <h2>2. Product Service (Port 5002)</h2>
        <form onsubmit="createProduct(event)">
            <input type="text" name="name" placeholder="Product Name" required>
            <input type="number" name="price" placeholder="Price" step="0.01" required>
            <button type="submit">Add Product</button>
        </form>
        <div id="products"></div>
    </div>

    <div class="section">
        <h2>3. Order Service (Port 5003)</h2>
        <p style="font-size: 12px; color: #666;">Order Service communicates with Product Service to get product details</p>
        <form onsubmit="createOrder(event)">
            <select name="user_id" id="userSelect" required>
                <option value="">Select User</option>
            </select>
            <select name="product_id" id="productSelect" required>
                <option value="">Select Product</option>
            </select>
            <input type="number" name="quantity" placeholder="Quantity" value="1" required>
            <button type="submit">Create Order</button>
        </form>
        <div id="orders"></div>
    </div>

    <div class="section">
        <h2>4. Payment Service (Port 5004)</h2>
        <p style="font-size: 12px; color: #666;">Payment Service communicates with Order Service to get order details</p>
        <form onsubmit="createPayment(event)">
            <select name="order_id" id="orderSelect" required>
                <option value="">Select Order</option>
            </select>
            <button type="submit">Process Payment</button>
        </form>
        <div id="payments"></div>
    </div>
    <script>
        const SERVICES = {
            user: 'http://localhost:5001',
            product: 'http://localhost:5002',
            order: 'http://localhost:5003',
            payment: 'http://localhost:5004'
        };

        function checkServices() {
        }

        function createUser(e) {
            e.preventDefault();
            fetch(`${SERVICES.user}/api/users`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    email: e.target.email.value,
                    name: e.target.name.value
                })
            }).then(() => loadData());
        }

        function createProduct(e) {
            e.preventDefault();
            fetch(`${SERVICES.product}/api/products`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    name: e.target.name.value,
                    price: parseFloat(e.target.price.value)
                })
            }).then(() => loadData());
        }
        
        function createOrder(e) {
            e.preventDefault();
            fetch(`${SERVICES.order}/api/orders`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    user_id: parseInt(e.target.user_id.value),
                    product_id: parseInt(e.target.product_id.value),
                    quantity: parseInt(e.target.quantity.value)
                })
            }).then(() => loadData());
        }
        
        function createPayment(e) {
            e.preventDefault();
            fetch(`${SERVICES.payment}/api/payments`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    order_id: parseInt(e.target.order_id.value)
                })
            }).then(() => loadData());
        }
        
        function loadData() {
            fetch(`${SERVICES.user}/api/users`).then(r => r.json()).then(data => {
                document.getElementById('users').innerHTML = data.map(u => 
                    `<div class="item">${u.name} (${u.email})</div>`
                ).join('');
                const select = document.getElementById('userSelect');
                select.innerHTML = '<option value="">Select User</option>' + 
                    data.map(u => `<option value="${u.id}">${u.name}</option>`).join('');
            });
            
            fetch(`${SERVICES.product}/api/products`).then(r => r.json()).then(data => {
                document.getElementById('products').innerHTML = data.map(p => 
                    `<div class="item">${p.name} - $${p.price}</div>`
                ).join('');
                const select = document.getElementById('productSelect');
                select.innerHTML = '<option value="">Select Product</option>' + 
                    data.map(p => `<option value="${p.id}">${p.name} - $${p.price}</option>`).join('');
            });
            
            fetch(`${SERVICES.order}/api/orders`).then(r => r.json()).then(data => {
                document.getElementById('orders').innerHTML = data.map(o => 
                    `<div class="item">Order #${o.id}: ${o.product_name || 'N/A'} x${o.quantity} = $${o.total} (${o.status})</div>`
                ).join('');
                const select = document.getElementById('orderSelect');
                select.innerHTML = '<option value="">Select Order</option>' + 
                    data.filter(o => o.status === 'PENDING').map(o => 
                        `<option value="${o.id}">Order #${o.id} - $${o.total}</option>`
                    ).join('');
            });
            
            fetch(`${SERVICES.payment}/api/payments`).then(r => r.json()).then(data => {
                document.getElementById('payments').innerHTML = data.map(p => 
                    `<div class="item">Payment #${p.id}: $${p.amount} (${p.status})</div>`
                ).join('');
            });
        }
        
        checkServices();
        loadData();
        setInterval(loadData, 2000);
        setInterval(checkServices, 5000);
    </script>
</body>
</html>